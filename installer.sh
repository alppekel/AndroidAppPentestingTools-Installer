#!/bin/bash

#####################################################################
# This script installs tools that can help to analyze android apps  #
#                                                                   #
# Tested on Ubuntu 20.04                                            #
#								    #
#####################################################################


function usage(){
	echo
        echo "Usage: ./my_script.sh [options]"
        echo
        echo "Options:"
        echo "-h or --help : Print help."
        echo "-l or --list : List packages that can be installed."
        echo "-i or --install [package name] : Install specific package."
        echo "-a or --all : Install all packages."
        echo
}

function package_list(){
        echo "Package List:"
        echo
        echo "1) Drozer"
        echo "2) MobSF"
        echo "3) Apktool"
        echo "4) Jd-gui"
        echo "5) Dex2jar"
        echo "6) Android Studio"
        echo "7) Andbug"
        echo "8) Frida"
        echo "9) Qark"
        echo "10) Apkx"
	echo "11) Objection"
}

#####################################################################
# Install  Functions                                                #
#####################################################################

function install_dependencies(){
	echo
	echo "Installing Dependencies"
	sudo apt update -y
	sudo apt install build-essential git python-dev-is-python2 default-jre\
	default-jdk python3-pip curl -y
	curl https://bootstrap.pypa.io/pip/2.7/get-pip.py --output get-pip.py
	sudo python2 get-pip.py
	rm get-pip.py

}

function install_drozer(){
	echo
	mkdir drozer
	cd drozer
	echo "Downloading Drozer"
	wget https://github.com/FSecureLABS/drozer/releases/download/2.4.4/drozer-2.4.4-py2-none-any.whl
	echo "Installing Drozer"
	sudo pip2.7 install wheel
	sudo pip2.7 install pyyaml
	sudo pip2.7 install pyhamcrest
	sudo pip2.7 install protobuf
	sudo pip2.7 install pyopenssl
	sudo pip2.7 install twisted
	sudo pip2.7 install service_identity
	sudo pip2.7 install drozer-2.4.4-py2-none-any.whl
	cd ..
	echo "Downloading Drozer Agent"
	wget https://github.com/FSecureLABS/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk
}

function install_frida(){
	echo
	echo "Installing Frida"
	sudo pip3 install frida-tools
}

function install_mobSF(){
	echo
	echo "Downlading and Installing mobSF"
	sudo apt install python3-venv python3-dev build-essential \
	libffi-dev libssl-dev libxml2-dev libxslt1-dev libjpeg8-dev zlib1g-dev -y
	git clone https://github.com/MobSF/Mobile-Security-Framework-MobSF.git
	cd Mobile-Security-Framework-MobSF/
	sudo ./setup.sh
	cd ..
}

function install_qark(){
	echo
	echo "Downloading and Installing Qark"
	git clone https://github.com/linkedin/qark
	cd qark
	sudo pip2.7 install -r requirements.txt
	sudo pip2.7 install .
	cd ..
}

function install_dex2jar(){
	echo
	echo "Downloading dex2jar"
	wget https://sourceforge.net/projects/dex2jar/files/dex2jar-2.0.zip
	unzip -xqq dex2jar-2.0.zip
	cd dex2jar-2.0
	chmod +x d2j_invoke.sh
	cd ..
	rm -r dex2jar-2.0.zip
}

function install_jd-gui(){
	echo
	echo "Downloading JD-GUI"
	git clone https://github.com/java-decompiler/jd-gui.git
	cd jd-gui
	echo
	echo "Building JD-GUI"
	./gradlew build
	cd ..
	cp jd-gui/build/libs/jd-gui-*.jar .
	rm jd-gui-*-min.jar
}

function install_apkx(){
	echo
	echo "Downloading and Installing Apkx"
	git clone https://github.com/b-mueller/apkx
	cd apkx
	echo
	echo "Installing Apkx"
	sudo ./install.sh
	cd ..
}

function install_apktool(){
	echo
	echo "Downloading Apktool"
	wget https://raw.githubusercontent.com/iBotPeaches/Apktool/master/scripts/linux/apktool
	wget https://github.com/iBotPeaches/Apktool/releases/download/v2.5.0/apktool_2.5.0.jar
	mv apktool_2.5.0.jar apktool.jar
	sudo cp apktool.jar apktool /usr/local/bin
	sudo chmod +x /usr/local/bin/apktool.jar
	sudo chmod +x /usr/local/bin/apktool
	rm apktool
	rm apktool.jar
}

function install_andbug(){
	echo
	echo "Downloading and Installing AndBug"
	git clone https://github.com/swdunlop/AndBug.git
	cd AndBug
	sudo python setup.py install
	cd ..
}

function install_android_studio(){
	echo
	echo "Downloading and Installing Android Studio"
	wget https://redirector.gvt1.com/edgedl/android/studio/ide-zips/2020.3.1.22/android-studio-2020.3.1.22-linux.tar.gz
	tar xvzf android-studio-*.tar.gz
	cd android-studio/bin/
	./studio.sh
	cd ../../
	rm android-studio-*.tar.gz
	sudo ln ~/Android/Sdk/platform-tools/adb /bin/adb
}

function install_objection(){
	echo
	echo "Installing Objection and Dependencies"
	sudo apt install aapt -y
	sudo apt install apksigner -y
	sudo apt install zipalign -y
	sudo pip3 install objection
}

function install_all(){
	echo
	echo "Installing all packages"
        install_apktool
        install_apkx
        install_jd-gui
        install_dex2jar
        install_qark
        install_mobSF
        install_frida
	install_drozer
	install_android_studio
	install_andbug
	install_objection
	exit
}


######################################################
# Main                                               #
######################################################


case "$1" in
	"-h"|"--help")	usage;exit;;
	"-l"|"--list")	package_list;exit;;
	"-a"|"--all")	install_all;;
	"-i"|"--install")
		if [[ "$2" == "android-studio" ]];then
			install_android_studio
		fi
		if [[ "$2" == "andbug" ]];then
			install_andbug
		fi
		if [[ "$2" == "apktool" ]];then
			install_apktool
		fi
		if [[ "$2" == "apkx" ]];then
                        install_apkx
                fi
		if [[ "$2" == "jd-gui" ]];then
                        install_jd-gui
                fi
		if [[ "$2" == "dex2jar" ]];then
                        install_dex2jar
                fi
		if [[ "$2" == "qark" ]];then
                        install_qark
                fi
		if [[ "$2" == "mobsf" ]];then
                        install_mobSF
                fi
		if [[ "$2" == "frida" ]];then
                        install_frida
                fi
		if [[ "$2" == "drozer" ]];then
                        install_drozer
                fi
		if [[ "$2" == "dependencies" ]];then
                        install_dependencies
                fi
		if [[ "$2" == "objection" ]];then
                        install_objection
                fi
		;;
	*) usage;exit;;
esac
